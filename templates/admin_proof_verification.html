<!-- templates/admin_proof_verification.html -->
{% extends "base.html" %}

{% block title %}Proof Verification - Admin{% endblock %}

{% block content %}
<div class="card">
    <h2 style="color: #2c3e50; margin-bottom: 30px;">
        <i class="fas fa-fingerprint"></i> Cryptographic Proof Verification
    </h2>
    <p style="color: #666; margin-bottom: 30px;">Verify cryptographic proof of ownership for all claims.</p>
    
    <!-- Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stat-card" style="background: #e8f4f8;">
            <h3>{{ claims|length }}</h3>
            <p>Claims with Proof</p>
        </div>
        <div class="stat-card" style="background: #d4edda;">
            <h3>{{ claims|selectattr('cryptographic_score', '>=', 80)|list|length }}</h3>
            <p>Strong Proofs (≥80%)</p>
        </div>
        <div class="stat-card" style="background: #fff3cd;">
            <h3>{{ claims|selectattr('cryptographic_score', '>=', 60)|selectattr('cryptographic_score', '<', 80)|list|length }}</h3>
            <p>Moderate Proofs (60-79%)</p>
        </div>
        <div class="stat-card" style="background: #f8d7da;">
            <h3>{{ claims|selectattr('cryptographic_score', '<', 60)|list|length }}</h3>
            <p>Weak Proofs (<60%)</p>
        </div>
    </div>
    
    <!-- Claims Table -->
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 15px; text-align: left;">Claim ID</th>
                    <th style="padding: 15px; text-align: left;">Item</th>
                    <th style="padding: 15px; text-align: left;">Claimant</th>
                    <th style="padding: 15px; text-align: left;">Proof Score</th>
                    <th style="padding: 15px; text-align: left;">Verification Level</th>
                    <th style="padding: 15px; text-align: left;">Evidence</th>
                    <th style="padding: 15px; text-align: left;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for claim in claims %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 15px;">{{ claim.id }}</td>
                    <td style="padding: 15px;">
                        <strong>{{ claim.item_title }}</strong><br>
                        <small style="color: #666;">{{ claim.item_category }}</small>
                    </td>
                    <td style="padding: 15px;">{{ claim.claimant_username }}</td>
                    <td style="padding: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 50px; height: 10px; background: #eee; border-radius: 5px; overflow: hidden;">
                                <div style="width: {{ claim.cryptographic_score }}%; height: 100%; background: 
                                    {% if claim.cryptographic_score >= 80 %}#27ae60
                                    {% elif claim.cryptographic_score >= 60 %}#f39c12
                                    {% elif claim.cryptographic_score >= 40 %}#e67e22
                                    {% else %}#e74c3c{% endif %};"></div>
                            </div>
                            <span style="font-weight: bold; color: 
                                {% if claim.cryptographic_score >= 80 %}#27ae60
                                {% elif claim.cryptographic_score >= 60 %}#f39c12
                                {% elif claim.cryptographic_score >= 40 %}#e67e22
                                {% else %}#e74c3c{% endif %}">
                                {{ claim.cryptographic_score }}%
                            </span>
                        </div>
                    </td>
                    <td style="padding: 15px;">
                        <span style="padding: 5px 10px; border-radius: 15px; 
                            {% if claim.verification_level == 'premium' %}background: #d4edda; color: #155724;
                            {% elif claim.verification_level == 'enhanced' %}background: #fff3cd; color: #856404;
                            {% else %}background: #f8f9fa; color: #666;{% endif %}">
                            {{ claim.verification_level|title }}
                        </span>
                    </td>
                    <td style="padding: 15px;">
                        {% if claim.parsed_proof.proof_data %}
                        <div style="color: #666; font-size: 0.9rem;">
                            {% set pd = claim.parsed_proof.proof_data %}
                            {% if pd.serial_number %}<div>• Serial Number</div>{% endif %}
                            {% if pd.purchase_date %}<div>• Purchase Date</div>{% endif %}
                            {% if pd.detailed_description %}<div>• Detailed Description</div>{% endif %}
                            {% if pd.photo_evidence %}<div>• Photo Evidence</div>{% endif %}
                        </div>
                        {% endif %}
                    </td>
                    <td style="padding: 15px;">
                        <a href="{{ url_for('admin_verify_claim', claim_id=claim.id) }}" 
                           class="btn btn-sm" style="background: #3498db; color: white;">
                            <i class="fas fa-search"></i> Verify
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Verification Guide -->
    <div class="card" style="margin-top: 30px; background: #f8f9fa; border-left: 4px solid #3498db;">
        <h4 style="color: #2c3e50; margin-bottom: 15px;">
            <i class="fas fa-graduation-cap"></i> How to Verify Cryptographic Proof
        </h4>
        <ol style="color: #666; padding-left: 20px;">
            <li><strong>Check Digital Signature:</strong> Verify HMAC-SHA256 signature matches claimant key</li>
            <li><strong>Verify Timestamp:</strong> Ensure proof was submitted within 1 hour window</li>
            <li><strong>Evaluate Evidence:</strong> Score each piece of evidence (0-100 points)</li>
            <li><strong>Check Serial Numbers:</strong> Validate against manufacturer databases if available</li>
            <li><strong>Review Detailed Descriptions:</strong> Look for unique, verifiable details</li>
            <li><strong>Cross-reference:</strong> Match evidence with item description and photos</li>
        </ol>
    </div>
</div>

<style>
.stat-card {
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}
.stat-card h3 {
    font-size: 2.5rem;
    margin: 0;
    color: #2c3e50;
}
.stat-card p {
    margin: 10px 0 0 0;
    color: #666;
}
.btn-sm {
    padding: 5px 15px;
    border-radius: 5px;
    text-decoration: none;
    display: inline-block;
    font-size: 0.9rem;
}
</style>
{% endblock %}